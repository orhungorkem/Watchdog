<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Watchdog: watchdog.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Watchdog
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('watchdog_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">watchdog.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/wait.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;signal.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8d62da7cccd2d679752fc21b18c28755"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8c.html#a8d62da7cccd2d679752fc21b18c28755">generate</a> (pid_t pidList[])</td></tr>
<tr class="memdesc:a8d62da7cccd2d679752fc21b18c28755"><td class="mdescLeft">&#160;</td><td class="mdescRight">The function to generate child processes as many as given number_of_processes.  <a href="watchdog_8c.html#a8d62da7cccd2d679752fc21b18c28755">More...</a><br /></td></tr>
<tr class="separator:a8d62da7cccd2d679752fc21b18c28755"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78040147142a03ee142f0cffa961ac10"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8c.html#a78040147142a03ee142f0cffa961ac10">handleTermination</a> (pid_t pid, pid_t pidList[])</td></tr>
<tr class="memdesc:a78040147142a03ee142f0cffa961ac10"><td class="mdescLeft">&#160;</td><td class="mdescRight">The function to handle termination of the child processes.  <a href="watchdog_8c.html#a78040147142a03ee142f0cffa961ac10">More...</a><br /></td></tr>
<tr class="separator:a78040147142a03ee142f0cffa961ac10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff90a0d4ce2320c10fd07007073546c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8c.html#aff90a0d4ce2320c10fd07007073546c7">sigterm</a> ()</td></tr>
<tr class="memdesc:aff90a0d4ce2320c10fd07007073546c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Signal handler for SIGTERM.  <a href="watchdog_8c.html#aff90a0d4ce2320c10fd07007073546c7">More...</a><br /></td></tr>
<tr class="separator:aff90a0d4ce2320c10fd07007073546c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">General flow for lifetime of watchdog process is managed.  <a href="watchdog_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">More...</a><br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ad40dac89bb0531c14fb75e6b17762331"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8c.html#ad40dac89bb0531c14fb75e6b17762331">number_of_processes</a></td></tr>
<tr class="separator:ad40dac89bb0531c14fb75e6b17762331"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08b4ee82378ebd2e504a535a28c89569"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8c.html#a08b4ee82378ebd2e504a535a28c89569">watchdog_output_path</a> [1000]</td></tr>
<tr class="separator:a08b4ee82378ebd2e504a535a28c89569"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab33a20b403b17bf20807b26c1ded0637"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8c.html#ab33a20b403b17bf20807b26c1ded0637">process_output_path</a> [1000]</td></tr>
<tr class="separator:ab33a20b403b17bf20807b26c1ded0637"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a320b747b530b47d5a291a857d2f5d355"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8c.html#a320b747b530b47d5a291a857d2f5d355">myfifo</a> =(char*) &quot;/tmp/myfifo&quot;</td></tr>
<tr class="separator:a320b747b530b47d5a291a857d2f5d355"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa065f30aa9f5f9a42132c82c787ee70b"><td class="memItemLeft" align="right" valign="top">FILE *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8c.html#aa065f30aa9f5f9a42132c82c787ee70b">fp</a></td></tr>
<tr class="separator:aa065f30aa9f5f9a42132c82c787ee70b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89d2a721c7f55fc2c00e46be773fad6a"><td class="memItemLeft" align="right" valign="top">FILE *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8c.html#a89d2a721c7f55fc2c00e46be773fad6a">fp2</a></td></tr>
<tr class="separator:a89d2a721c7f55fc2c00e46be773fad6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f8059414f0228f0256115e024eeed4b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="watchdog_8c.html#a6f8059414f0228f0256115e024eeed4b">fd</a></td></tr>
<tr class="separator:a6f8059414f0228f0256115e024eeed4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32b2c07bf2f64897de048c86e709760f"><td class="memItemLeft" align="right" valign="top"><a id="a32b2c07bf2f64897de048c86e709760f"></a>
struct timespec&#160;</td><td class="memItemRight" valign="bottom"><b>delta</b> = {0 , 400000000 }</td></tr>
<tr class="separator:a32b2c07bf2f64897de048c86e709760f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Orhun Görkem </dd></dl>
<dl class="section date"><dt>Date</dt><dd>26 Dec 2020 <br  />
 File that specifies actions of the watchdog process. <br  />
 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a8d62da7cccd2d679752fc21b18c28755"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d62da7cccd2d679752fc21b18c28755">&#9670;&nbsp;</a></span>generate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void generate </td>
          <td>(</td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pidList</em>[]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The function to generate child processes as many as given number_of_processes. </p>
<p>Children are generated with a for loop and sequential fork() calls. nanosleep() is used with 0.2 seconds to preserve the ascending order of process numbers. Process numbers are different than process id's. Process numbers are used to enumarate the children. After forking each child, its process id is stored in pidList to recall afterall. The process id's are also written to the named pape where executor can read. <br  />
Child processes execute <a class="el" href="process_8c.html">process.c</a> since their work mechanism is different. This is provided with execlp(). The process_output_path and process number are passed as arguments to execlp() since children will need them. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pidList</td><td>The list of process id's of child processes, to map the process numbers to process id's. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="watchdog_8c.html#ad40dac89bb0531c14fb75e6b17762331">number_of_processes</a> </dd>
<dd>
<a class="el" href="watchdog_8c.html#ab33a20b403b17bf20807b26c1ded0637">process_output_path</a> </dd></dl>

</div>
</div>
<a id="a78040147142a03ee142f0cffa961ac10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78040147142a03ee142f0cffa961ac10">&#9670;&nbsp;</a></span>handleTermination()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleTermination </td>
          <td>(</td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pid_t&#160;</td>
          <td class="paramname"><em>pidList</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The function to handle termination of the child processes. </p>
<p>Given pid and pidList, the terminated child is detected with a for loop. Detecting which child is terminated is important since if P1 (head process) is terminated, all others must also be killed and restarted. If another process is terminated, the job for watchdog to do is just restarting the terminated child. In addition, the termination and restarting operation must be logged to watchdog output file, then inferring which child is terminated is important in case of logging the process number of the corresponding child to watchdog output file. <br  />
When head process dies, watchdog kills other processes by sending SIGTERM. To preserve the order of ascending process numbers, wait system call is used after each SIGTERM sent. When wait returns with the news of child is terminated, the next child is sent SIGTERM. <br  />
After each child process is killed, all of them are restared by <a class="el" href="watchdog_8c.html#a8d62da7cccd2d679752fc21b18c28755" title="The function to generate child processes as many as given number_of_processes.">generate()</a>. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pid</td><td>The process id of terminated child. </td></tr>
    <tr><td class="paramname">pidList</td><td>The list of process id's of child processes, to map the process numbers to process id's. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="watchdog_8c.html#a8d62da7cccd2d679752fc21b18c28755" title="The function to generate child processes as many as given number_of_processes.">generate()</a> </dd></dl>

</div>
</div>
<a id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>General flow for lifetime of watchdog process is managed. </p>
<p>Watchdog is responsible for generating given number of processes and restarting them if any of them terminates. On the other hand, watchdog passes process id's of its children to a named pipe where executor can reach. This helps executor in the sense of killing the signals to correct processes. <br  />
To achieve these goals, watchdog opens the named pipe, generates the children by <a class="el" href="watchdog_8c.html#a8d62da7cccd2d679752fc21b18c28755" title="The function to generate child processes as many as given number_of_processes.">generate()</a> and finally gets in an infinite loop. In the loop, it waits for terminations of children by wait() system call. When termination occurs <a class="el" href="watchdog_8c.html#a78040147142a03ee142f0cffa961ac10" title="The function to handle termination of the child processes.">handleTermination()</a> is called where necessary actions are hold. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="watchdog_8c.html#ad40dac89bb0531c14fb75e6b17762331">number_of_processes</a> is taken as an argument </dd>
<dd>
<a class="el" href="watchdog_8c.html#ab33a20b403b17bf20807b26c1ded0637">process_output_path</a> is taken as an argument </dd>
<dd>
<a class="el" href="watchdog_8c.html#a08b4ee82378ebd2e504a535a28c89569">watchdog_output_path</a> is taken as an argument </dd>
<dd>
<a class="el" href="watchdog_8c.html#a78040147142a03ee142f0cffa961ac10" title="The function to handle termination of the child processes.">handleTermination()</a> </dd>
<dd>
<a class="el" href="watchdog_8c.html#a8d62da7cccd2d679752fc21b18c28755" title="The function to generate child processes as many as given number_of_processes.">generate()</a> </dd></dl>

</div>
</div>
<a id="aff90a0d4ce2320c10fd07007073546c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff90a0d4ce2320c10fd07007073546c7">&#9670;&nbsp;</a></span>sigterm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sigterm </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Signal handler for SIGTERM. </p>
<p>Executed when SIGTERM signal is received. Opens process output file and handles the signal by printing the relevant expression. After that, process exits with exit() system call. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a6f8059414f0228f0256115e024eeed4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f8059414f0228f0256115e024eeed4b">&#9670;&nbsp;</a></span>fd</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fd</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The file descriptor for named pipe </p>

</div>
</div>
<a id="aa065f30aa9f5f9a42132c82c787ee70b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa065f30aa9f5f9a42132c82c787ee70b">&#9670;&nbsp;</a></span>fp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* fp</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The file descriptor for watchdog output file </p>

</div>
</div>
<a id="a89d2a721c7f55fc2c00e46be773fad6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89d2a721c7f55fc2c00e46be773fad6a">&#9670;&nbsp;</a></span>fp2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FILE* fp2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The file descrpitor for process output file </p>

</div>
</div>
<a id="a320b747b530b47d5a291a857d2f5d355"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a320b747b530b47d5a291a857d2f5d355">&#9670;&nbsp;</a></span>myfifo</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* myfifo =(char*) &quot;/tmp/myfifo&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The path for named pipe </p>

</div>
</div>
<a id="ad40dac89bb0531c14fb75e6b17762331"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad40dac89bb0531c14fb75e6b17762331">&#9670;&nbsp;</a></span>number_of_processes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int number_of_processes</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The number of processes that watchdog should generate and keep in execution </p>

</div>
</div>
<a id="ab33a20b403b17bf20807b26c1ded0637"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab33a20b403b17bf20807b26c1ded0637">&#9670;&nbsp;</a></span>process_output_path</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char process_output_path[1000]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The path of output file for child processes <br  />
 </p>

</div>
</div>
<a id="a08b4ee82378ebd2e504a535a28c89569"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08b4ee82378ebd2e504a535a28c89569">&#9670;&nbsp;</a></span>watchdog_output_path</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char watchdog_output_path[1000]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The path of output file for watchdog <br  />
 </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="watchdog_8c.html">watchdog.c</a></li>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
